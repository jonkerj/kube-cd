apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: zigbee2mqtt
spec:
  interval: 5m
  chart:
    spec:
      chart: zigbee2mqtt
      version: 2.8.0
      sourceRef:
        kind: HelmRepository
        name: zigbee2mqtt
  values:
    ingress:
      enabled: true
      ingressClassName: cilium
      hosts:
      - host: zigbee2mqtt.9ka.nl
        paths:
        - path: /
          pathType: Prefix
      annotations:
        external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
        external-dns.alpha.kubernetes.io/hostname: zigbee2mqtt.9ka.nl
        external-dns.alpha.kubernetes.io/target: 431113a6-4cf3-4a66-9750-17113ae2e689.cfargotunnel.com
    service:
      type: ClusterIP
    statefulset:
      storage:
        enabled: true
        storageClassName: nfs-nvme
      nodeSelector:
        feature.node.kubernetes.io/usb-ff_0403_6001.present: "true"
      tolerations:
      - effect: NoSchedule
        key: efgh.nl/location
        value: gangkast
      volumeMounts:
      - name: dev-serial
        mountPath: /dev/serial
      volumes:
      - name: dev-serial
        hostPath:
          path: /dev/serial
          type: Directory
      resources:
        requests:
          memory: 90Mi
          cpu: 10m
        limits:
          memory: 300Mi
          cpu: 250m
    zigbee2mqtt:
      homeassistant:
        enabled: false
      mqtt:
        server: mqtt://mosquitto:1883"
      serial:
        port: /dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B001CD4ECE2-if00
        adapter: zstack